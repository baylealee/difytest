name: Process vendorex Segmentation

# 支援手動觸發和文件變更觸發
on:
  push:
    paths:
      - 'vendorex.xlsx'  # 當 vendorex.xlsx 文件有變更時觸發
  workflow_dispatch:  # 手動觸發

jobs:
  process:
    runs-on: ubuntu-latest

    # 確保 GitHub Actions 具有推送權限
    permissions:
      contents: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Call Dify API for processing
        run: |
          curl -X POST "https://api.dify.ai/v1" \
          -H "Authorization: Bearer app-Zhkmaz6JQgaSooV4NWuSIj7Z" \
          -H "Content-Type: application/json" \
          -d '{
                "file_url": "https://raw.githubusercontent.com/baylealee/difytest/main/vendorex.xlsx",
                "process_type": "vendor_segmentation",
                "output_format": "csv"
              }' > processed_vendorex.csv

      - name: Commit the processed file back to GitHub
        run: |
          git config --global user.email "btokaahi@gmail.com"
          git config --global user.name "baylea"
          git add processed_vendorex.csv
          git commit -m "Processed vendorex segmentation and updated CSV"
          git push
